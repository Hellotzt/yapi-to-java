<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Yapi To Java</title>
    <link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/bootstrap/5.1.3/css/bootstrap.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
</head>
<body>

<form>
    <br>
    <h2 style="text-align: center;">Welcome Yapi To Java</h2>
    <br>
    <div class="mb-3" style="width: 80%; margin-left: auto; margin-right: auto;">
        <div class="row g-2">
            <div class="col-md">
                <div class="form-floating mb-3">
                    <input type="email" class="form-control" id="yapiUrlByInput">
                    <label for="yapiUrlByInput">YapiÊé•Âè£Ë∑ØÂæÑÔºö</label>
                </div>
            </div>
            <div class="col-md">
                <div class="form-floating mb-3">
                    <input type="email" class="form-control" id="cookieByInput">
                    <label for="cookieByInput">CookieÔºö</label>
                </div>
            </div>
            <button type="button" class="btn btn-outline-primary" onclick="requestData()">ËØ∑Ê±Ç</button>
        </div>
        <br>
        <br>
        <div class="row g-2">
            <div class="col">
                <div id="reqCodeBox"></div>
            </div>
            <div class="col">
                <div id="respCodeBox"></div>
            </div>
        </div>
    </div>
</form>

<script>

    // Âú®È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéË∞ÉÁî®ÊñπÊ≥ïÂ±ïÁ§∫ÁºìÂ≠òÁöÑÊï∞ÊçÆ
    window.onload = function () {
        // ‰ªéÁºìÂ≠ò‰∏≠Ëé∑ÂèñcookieÁöÑÂÄº
        const storedCookie = window.localStorage.getItem("cookieByInput");
        if (storedCookie) {
            document.getElementById("cookieByInput").value = storedCookie;
        }
    };
    let respCode = [];
    let reqCode = [];
    const buildDom = (index, title) => ` <div class="col" data-index=${index}>
                    <div class="card">
                        <h5 class="card-header">${title}</h5>
                            <div class="code java ${title}"  style="height: 100%; "></div>
                        <button type="button" class="btn btn-outline-primary" onclick="copy(${index},'${title}')">
                            Â§çÂà∂
                        </button>
                    </div>
                </div>`
    const copy = async (index, title) => {
        // console.log(index + title);
        // let clickValue;
        // if ("request" === title) {
        //     clickValue = reqCode[index];
        // } else {
        //     clickValue = respCode[index];
        // }
        // console.log(clickValue);
        //
        // try {
        //     await navigator.clipboard.writeText(clickValue);
        //     alert("Â§çÂà∂ÊàêÂäü");
        // } catch (err) {
        //     console.error("Â§çÂà∂Â§±Ë¥•:", err);
        //     alert("Â§çÂà∂Â§±Ë¥•");
        // }
        // ‰∏äÈù¢apiÈúÄË¶ÅÂú®‰∏ä‰∏ãÊñáÂÆâÂÖ®ÁöÑÁéØÂ¢ÉÊâçËÉΩÊîØÊåÅ ÂæÖËß£ÂÜ≥
        console.log(index + title);
        let clickValue;
        if ("request" === title) {
            clickValue = reqCode[index];
        } else {
            clickValue = respCode[index];
        }
        console.log(clickValue);

        // ÂàõÂª∫Êñ∞ÁöÑ textarea ÂÖÉÁ¥†
        const textarea = document.createElement("textarea");
        // ËÆæÁΩÆ textarea ÁöÑÂÄº‰∏∫Ë¶ÅÂ§çÂà∂ÁöÑÊñáÊú¨ÂÜÖÂÆπ
        textarea.value = clickValue;
        // Â∞Ü textarea Ê∑ªÂä†Âà∞È°µÈù¢‰∏≠
        document.body.appendChild(textarea);
        // ÈÄâÊã© textarea ‰∏≠ÁöÑÊñáÊú¨
        textarea.select();
        // Â§çÂà∂ÊñáÊú¨Âà∞Ââ™Ë¥¥Êùø
        document.execCommand("copy");
        // ÁßªÈô§ textarea ÂÖÉÁ¥†
        document.body.removeChild(textarea);
        alert("Â§çÂà∂ÊàêÂäü");
    }

    function requestData() {
        let apiUrl = "http://192.168.3.98:8080/toJavaObject";
        const yapiUrlByInput = document.getElementById("yapiUrlByInput").value;
        if (yapiUrlByInput == null || yapiUrlByInput === "" || yapiUrlByInput.indexOf("http") === -1) {
            alert("ËØ∑ËæìÂÖ•YapiÊé•Âè£Ë∑ØÂæÑ");
            return;
        }
        const cookieByInput = document.getElementById("cookieByInput").value;
        if (cookieByInput == null || cookieByInput === "") {
            alert("ËØ∑ËæìÂÖ•cookieüç™");
            return;
        }
        // cookieByInputÊîæÂà∞ÁºìÂ≠ò‰∏≠
        window.localStorage.setItem("cookieByInput", cookieByInput);

        let xhr = new XMLHttpRequest();
        xhr.open("Post", apiUrl, true);
        xhr.setRequestHeader("Content-Type", "application/json");
        let sendValue = JSON.stringify({
            "apiUrl": yapiUrlByInput,
            "cookie": cookieByInput
        });

        xhr.onreadystatechange = function () {
            console.log(xhr.readyState);
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    let result = JSON.parse(xhr.responseText);
                    if (result.code !== "000000") {
                        document.getElementById("reqCodeBox").innerHTML = "";
                        document.getElementById("respCodeBox").innerHTML = "";
                        return alert(result.msg);
                    }
                    reqCode = result.data.requestJavaObject;
                    respCode = result.data.responseJavaObject;
                    let reqStrArr = reqCode.map((code, i) => buildDom(i, "request"));
                    document.getElementById("reqCodeBox").innerHTML = reqStrArr.join('<br>');

                    let respStrArr = respCode.map((code, i) => buildDom(i, "response"));
                    document.getElementById("respCodeBox").innerHTML = respStrArr.join('<br>');

                    const requestElements = document.querySelectorAll('.request');
                    requestElements.forEach((req, index) => {
                        req.innerHTML = reqCode[index].replace("<", "&lt;").replace(">", "&gt;");
                    });

                    const responseElements = document.querySelectorAll('.response');
                    responseElements.forEach((resp, index) => {
                        resp.innerHTML = respCode[index].replace("<", "&lt;").replace(">", "&gt;");
                    });
                    document.querySelectorAll('div.code').forEach((el) => {
                        hljs.highlightElement(el);
                    });
                }
            }
        }
        xhr.send(sendValue);

    }


</script>
</body>
<style>
    div.code {
        white-space: pre;
    }
</style>
</html>